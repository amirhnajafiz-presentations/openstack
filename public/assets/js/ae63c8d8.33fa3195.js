"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[49],{8021:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>c});var n=s(4848),r=s(8453);const t={},a="Processor and Virtual Machine Security",l={id:"System Security/vm",title:"Processor and Virtual Machine Security",description:"In this chapter, we focuse on processors and VMs security levels. Moreover, we will see how we can use VMs in security applications.",source:"@site/docs/System Security/2_vm.md",sourceDirName:"System Security",slug:"/System Security/vm",permalink:"/graphhub/docs/System Security/vm",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Memory Errors: Exploits and Defenses",permalink:"/graphhub/docs/System Security/memerr-rand"},next:{title:"Operating System Security",permalink:"/graphhub/docs/System Security/os"}},o={},c=[{value:"Processor Security",id:"processor-security",level:2},{value:"Virtualization is OSes",id:"virtualization-is-oses",level:2},{value:"System Virtualization",id:"system-virtualization",level:2},{value:"Process virtualization",id:"process-virtualization",level:3},{value:"OS or Namespace virtualization",id:"os-or-namespace-virtualization",level:3},{value:"Full virtualization",id:"full-virtualization",level:3},{value:"VMM Architectures",id:"vmm-architectures",level:3},{value:"Type 1 (baremetal)",id:"type-1-baremetal",level:4},{value:"Type 2 (hosted)",id:"type-2-hosted",level:4},{value:"Key issues in CPU virtualization",id:"key-issues-in-cpu-virtualization",level:3},{value:"Virtualization Approaches",id:"virtualization-approaches",level:3},{value:"Memory Virtualization",id:"memory-virtualization",level:3},{value:"I/O Virtualization",id:"io-virtualization",level:3},{value:"VMs security applications and concerns",id:"vms-security-applications-and-concerns",level:2},{value:"Security Applications",id:"security-applications",level:3},{value:"Rootkit",id:"rootkit",level:4},{value:"Security challenges in virtualized environments",id:"security-challenges-in-virtualized-environments",level:3},{value:"Docker security",id:"docker-security",level:3},{value:"Docker attack vectors",id:"docker-attack-vectors",level:4},{value:"Docker security practices",id:"docker-security-practices",level:4}];function d(e){const i={annotation:"annotation",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",math:"math",mo:"mo",mrow:"mrow",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.header,{children:(0,n.jsx)(i.h1,{id:"processor-and-virtual-machine-security",children:"Processor and Virtual Machine Security"})}),"\n",(0,n.jsx)(i.p,{children:"In this chapter, we focuse on processors and VMs security levels. Moreover, we will see how we can use VMs in security applications."}),"\n",(0,n.jsx)(i.h2,{id:"processor-security",children:"Processor Security"}),"\n",(0,n.jsx)(i.p,{children:"Processors operate at multiple privilege levels. At least two levels\r\nare needed, privileged and unprivileged."}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Ring 0"})," is highes privilege (kernel-level)"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Ring 3"})," is lowest privilege (user-level)"]}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"OS kernel runs in Ring 0, while user-level code executes in unprivileged mode. Improtant processor state can be changed only throught the execution of privileged instruction."}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Page tables"}),"\n",(0,n.jsx)(i.li,{children:"I/O devices"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"As a result, only the kernel code can change critical processor state. However, there is no control for transfers across privilege levels. So, privileged crossings are usually effected via interrupts. These interrupts are like request messages."}),"\n",(0,n.jsx)(i.h2,{id:"virtualization-is-oses",children:"Virtualization is OSes"}),"\n",(0,n.jsx)(i.p,{children:"Creation of logical instances of physical resources. Same functions, without rewriting the whole thing. Resources to virtualize are:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"CPU"}),"\n",(0,n.jsx)(i.li,{children:"Memory"}),"\n",(0,n.jsx)(i.li,{children:"I/O devices"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"Some resources are shared using high level interfaces rather than virtualization. Since only OS can control and manage system resources and share them safely across user-level processes, resources are often virtualized. It is as if a user-level process has an exclusive, private copy of that\r\nresource."}),"\n",(0,n.jsx)(i.h2,{id:"system-virtualization",children:"System Virtualization"}),"\n",(0,n.jsxs)(i.p,{children:["Creates several virtual systems within a single physical system. This virtual should still provide privileged instructions, so that OS kernels can run on top. ",(0,n.jsx)(i.strong,{children:"VVM (hypervisor)"})," is the software layer providing the virtualization. VM runs on top of the VMM. VMM runs in kernel-level (Ring 0)."]}),"\n",(0,n.jsx)(i.h3,{id:"process-virtualization",children:"Process virtualization"}),"\n",(0,n.jsx)(i.p,{children:"The VM supports an application binary interface that uses interrupts and system-calls. (JWM)"}),"\n",(0,n.jsx)(i.h3,{id:"os-or-namespace-virtualization",children:"OS or Namespace virtualization"}),"\n",(0,n.jsx)(i.p,{children:"Having multiple logical VMs that share the same OS kernel. Isolates VMs by partitioning all objects into namespaces. (Docker, vServer)"}),"\n",(0,n.jsx)(i.h3,{id:"full-virtualization",children:"Full virtualization"}),"\n",(0,n.jsx)(i.p,{children:"The VM supports a complete ISA and user and system instructions. (VirtualBox)"}),"\n",(0,n.jsx)(i.h3,{id:"vmm-architectures",children:"VMM Architectures"}),"\n",(0,n.jsxs)(i.p,{children:["There are two types of VMM, ",(0,n.jsx)(i.strong,{children:"baremetal"})," and ",(0,n.jsx)(i.strong,{children:"hosted"}),"."]}),"\n",(0,n.jsx)(i.h4,{id:"type-1-baremetal",children:"Type 1 (baremetal)"}),"\n",(0,n.jsx)(i.p,{children:"The VMM runs on bare hardware."}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"|+++++++++++++++++++| |+++++++++++++++++++|\r\n| guest application | | guest application |\r\n|+++++++++++++++++++| |+++++++++++++++++++|\r\n===========================================\r\n|++++++++++++++++++|\r\n|  multi guest OS  |\r\n|++++++++++++++++++|\r\n===========================================\r\n|+++++++++++++++++++|\r\n|        VMM        |\r\n|+++++++++++++++++++|\r\n===========================================\r\n|+++++++++++++++++++|\r\n|   host hardware   |\r\n|+++++++++++++++++++|\n"})}),"\n",(0,n.jsx)(i.h4,{id:"type-2-hosted",children:"Type 2 (hosted)"}),"\n",(0,n.jsx)(i.p,{children:"The VMM runs as an ordinary application inside host OS."}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"|+++++++++++++++++++| |+++++++++++++++++++|\r\n| guest application | | guest application |\r\n|+++++++++++++++++++| |+++++++++++++++++++|\r\n===========================================\r\n|++++++++++++++++++|\r\n|  multi guest OS  |\r\n|++++++++++++++++++|\r\n===========================================\r\n|+++++++++++++++++++|\r\n|        VMM        |\r\n|+++++++++++++++++++|\r\n===========================================\r\n|+++++++++++++++++++++++|\r\n| host operating system |\r\n|+++++++++++++++++++++++|\r\n===========================================\r\n|+++++++++++++++++++|\r\n|   host hardware   |\r\n|+++++++++++++++++++|\n"})}),"\n",(0,n.jsx)(i.h3,{id:"key-issues-in-cpu-virtualization",children:"Key issues in CPU virtualization"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Protection levels."}),"\n",(0,n.jsxs)(i.li,{children:["Requirement for efficient virtualization. Privileged instructions will be executed as traps if they come from user-level. Sensitive instructions are the ones that affect important system state. Therefore, if an instruction is privileged and sensitive, it can support efficient ",(0,n.jsx)(i.strong,{children:"trap and emulate"})," approach."]}),"\n",(0,n.jsx)(i.li,{children:"For x86, not all sensitive instructions are privileged."}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"virtualization-approaches",children:"Virtualization Approaches"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Full virtualization"})," using binary translation: needs disassemble the binary, identify instructions and patch them. Rely dynamic disassembly and translation in order to make disassembly tractable, and to support dynamic changes to code. (like VMware or QEMU)"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Paravirtualization"}),": OS modified to run on VMM, then it uses Hypercalls. It is no longer 100% interface compatible, but has better performance. (like Xen)"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Harware-assisted virtualization"}),": OS requests trap to VMM without binary translation or paravirtualization. Separates CPU execution into two modes. Hypervisor executes in host mode, and all VMs execute in guest mode. (most VMMs today)"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"memory-virtualization",children:"Memory Virtualization"}),"\n",(0,n.jsx)(i.p,{children:"Access to MMU needs to be virtualized, otherwise guest OS may directly access physical memory and subvert VMM. Physical memory is divided among multiple VMs with two levels of translation in Guest OS and VMM."}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Guest OS: guest virtual addr ",(0,n.jsxs)(i.span,{className:"katex",children:[(0,n.jsx)(i.span,{className:"katex-mathml",children:(0,n.jsx)(i.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(i.semantics,{children:[(0,n.jsx)(i.mrow,{children:(0,n.jsx)(i.mo,{children:"\u2192"})}),(0,n.jsx)(i.annotation,{encoding:"application/x-tex",children:"\\to"})]})})}),(0,n.jsx)(i.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(i.span,{className:"base",children:[(0,n.jsx)(i.span,{className:"strut",style:{height:"0.3669em"}}),(0,n.jsx)(i.span,{className:"mrel",children:"\u2192"})]})})]})," guest physical addr"]}),"\n",(0,n.jsxs)(i.li,{children:["VMM: guest physical addr ",(0,n.jsxs)(i.span,{className:"katex",children:[(0,n.jsx)(i.span,{className:"katex-mathml",children:(0,n.jsx)(i.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(i.semantics,{children:[(0,n.jsx)(i.mrow,{children:(0,n.jsx)(i.mo,{children:"\u2192"})}),(0,n.jsx)(i.annotation,{encoding:"application/x-tex",children:"\\to"})]})})}),(0,n.jsx)(i.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(i.span,{className:"base",children:[(0,n.jsx)(i.span,{className:"strut",style:{height:"0.3669em"}}),(0,n.jsx)(i.span,{className:"mrel",children:"\u2192"})]})})]})," machine addr"]}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"Shadow page table is needed to avoid 2-step translation. By using shadow page, when guest attempts to update, VMM intercepts and emulate the effects on the corresponding shadow page table."}),"\n",(0,n.jsx)(i.h3,{id:"io-virtualization",children:"I/O Virtualization"}),"\n",(0,n.jsx)(i.p,{children:"The VMM intercepts guest's I/O-performing instructions. Performs necessary actions to emulate their effect. This emulations leads to low performance for most I/O operations. Compared to CPU and memory, that are executed with less extra operations."}),"\n",(0,n.jsx)(i.h2,{id:"vms-security-applications-and-concerns",children:"VMs security applications and concerns"}),"\n",(0,n.jsx)(i.h3,{id:"security-applications",children:"Security Applications"}),"\n",(0,n.jsx)(i.p,{children:"VM technology provides strong isolation that is necessary to run malware\r\nwithout undue risks. (Strong resource isolation and snapshot/restore features)"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.strong,{children:"Honypots systems"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.strong,{children:"Malware analysis"})}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"Basically, it is using VMs for less damage and keep alignment in guest OS. Also, it provides protection from compromised OSes. Running malware and rootkit detection techniques in VMM, or enforce security properties from within the VMM."}),"\n",(0,n.jsx)(i.h4,{id:"rootkit",children:"Rootkit"}),"\n",(0,n.jsx)(i.p,{children:"A rootkit, is a set of software tools that enable an unauthorized user to gain control of a computer system without being detected."}),"\n",(0,n.jsx)(i.h3,{id:"security-challenges-in-virtualized-environments",children:"Security challenges in virtualized environments"}),"\n",(0,n.jsxs)(i.p,{children:["Since virtualization leads to ",(0,n.jsx)(i.strong,{children:"co-tenancy"}),", it has challenges."]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"VMs belonging to distinct principals use the same hadrware. Therefor, it needs strong isolation."}),"\n",(0,n.jsx)(i.li,{children:"It provides increased opportunities for side-channel attacks."}),"\n",(0,n.jsx)(i.li,{children:"Also, Denail of service is hard to prevent."}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"docker-security",children:"Docker security"}),"\n",(0,n.jsxs)(i.p,{children:["It uses ",(0,n.jsx)(i.strong,{children:"namespaces"})," and ",(0,n.jsx)(i.strong,{children:"cgroups"})," to isolate its containers. It also has a container infrastructure and services (",(0,n.jsx)(i.strong,{children:"docker daemon"}),"). Containerscan share files with the host OS, but this can be dangerous since it can allow root user in a container to change critical host OS files."]}),"\n",(0,n.jsx)(i.h4,{id:"docker-attack-vectors",children:"Docker attack vectors"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Shared kernel: it is using same OS kernel across different containers. Any kernel vulnerabilities may be exploited."}),"\n",(0,n.jsx)(i.li,{children:"Docker daemon needs root privileges. So, malicious processes may abuse this privilege."}),"\n",(0,n.jsx)(i.li,{children:"Apps running within Docker can reach to the host by sharing folders. Or, root processes inside container can possibly execute systemcalls as root on host."}),"\n"]}),"\n",(0,n.jsx)(i.h4,{id:"docker-security-practices",children:"Docker security practices"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Avoid root privilege."}),"\n",(0,n.jsx)(i.li,{children:"Limit further using linux capabilities."}),"\n",(0,n.jsx)(i.li,{children:"Use seccomp-bpf to limit system calls that can be made by processes within the container."}),"\n",(0,n.jsx)(i.li,{children:"Avoid using untrusted software."}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,i,s)=>{s.d(i,{R:()=>a,x:()=>l});var n=s(6540);const r={},t=n.createContext(r);function a(e){const i=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(t.Provider,{value:i},e.children)}}}]);